{% extends 'base.html' %}

{% load static %}

{% block body %}
<section>
   <div class="gap gray-bg">
      <div class="container-fluid">
         <div class="row">
            <div class="col-lg-12">
               <div class="row" id="page-contents">
                  <div class="col-lg-3">
                     <aside class="sidebar static">
                        <div class="widget">
                           <h4 class="widget-title">Shortcuts</h4>
                           <ul class="naves">
                              <li>
                                 <i class="ti-clipboard"></i>
                                 <a href="{% url 'app_social:index' %}" title="">Trang Chủ</a>
                              </li>
                              <li>
                                 <i class="ti-mouse-alt"></i>
                                 <a href="{% url 'app_social:profile' %}" title="">User</a>
                              </li>
                              <li>
                                 <i class="ti-files"></i>
                                 <a href="{% url 'app_social:list_group' %}" title="">Group</a>
                              </li>
                              <li>
                                 <i class="ti-files"></i>
                                 <a href="{% url 'app_social:list_page' %}" title="">Page</a>
                              </li>
                              <li>
                                 <i class="ti-user"></i>
                                 <a href="{% url 'app_social:friend_requests' %}" title="">Danh sách lời mời kết bạn</a>
                              </li>
                              <li>
                                 <i class="ti-user"></i>
                                 <a href="{% url 'app_social:blockingFriends' %}" title="">Danh sách đã chặn</a>
                              </li>
                              <li>
                                 <i class="ti-comments-smiley"></i>
                                 <a href="{% url 'homechat' %}" title="">Group Chat</a>
                              </li>
                              <li>
                                 <i class="ti-comments-smiley"></i>
                                 <a href="" title="">Messages</a>
                              </li>
                              <li>
                                 <i class="ti-power-off"></i>
                                 <a href="{% url 'app_social:change_password' %}" title="">Đổi Mật Khẩu</a>
                              </li>
                              <li>
                                 <i class="ti-power-off"></i>
                                 <a href="{% url 'app_social:logout' %}" title="">Logout</a>
                              </li>
                           </ul>
                        </div><!-- Shortcuts -->

                        <div class="widget stick-widgeta">
                           <h4 class="widget-title">Gợi Ys Kết Bạn</h4>
                           
                           <ul class="followers">
                              {% for friend in suggested_friends %}
                              <li>
                                 <figure><img src="/media/{{friend.avatar}}" alt="" style="width: 100px; height: 47px;">
                                 </figure>
                                 <div class="friend-meta">
                                    <h4><a href="{% url 'app_social:user_profile' friend.username %}"
                                          title>{{friend.last_name}} {{friend.first_name}}</a></h4>
                                    {% if not friend in user.friends.all %}
                                    <a href="{% url 'app_social:send_friend_request' friend.username %}" title=""
                                       class="underline">Add Friend</a>
                                    {% endif %}
                                 </div>
                                 {% if messages %}
                                 <ul class="messages">
                                    {% for message in messages %}
                                    <li{% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}
                              </li>
                              {% endfor %}
                           </ul>
                           {% endif %}
                           </li>
                           {% endfor %}
                           </ul>                          
                        </div><!-- who's Friend -->
                        <div class="widget stick-widgeta">
                           <h4 class="widget-title">Những Nhóm Có Thể Tham Gia</h4>                          
                           <ul class="followers">
                              {% for group in all_groups %}
                              <li>
                                 <figure><img src="{{ group.group_picture.url }}" alt="" style="width: 100px; height: 47px;">
                                 </figure>
                                 <div class="friend-meta">
                                    <h4><a href="{% url 'app_social:group_detail' group.id %}"
                                          title>{{group.name}}</a></h4>
                                    
                                    <a href="{% url 'app_social:join_group' group.id %}" title=""
                                       class="underline">Tham Gia</a>                                  
                                 </div>                                                                                                         
                           </li>
                           {% endfor %}
                           </ul>                          
                        </div><!-- who's following -->
                     </aside>
                  </div><!-- sidebar -->
                  <div class="col-lg-6">
                     <div class="central-meta">
                        <div class="new-postbox">
                           <figure>
                              <img src="/media/{{ user.avatar }}" alt="" style="height: 48px;
                              width: 47px;">
                           </figure>
                           <div class="newpst-input">
                              <form action="{% url 'app_social:create_post' %}" method="POST"
                                 enctype="multipart/form-data">
                                 {% csrf_token %}
                                 <textarea class="form-control" name="content" rows="2"
                                    placeholder="What are you thinking?"></textarea>
                                 <div class="attachments">
                                    <ul>
                                       <li>
                                          <i class="fa fa-music"></i>
                                          <label class="fileContainer">
                                             <input type="file">
                                          </label>
                                       </li>
                                       <li>
                                          <i class="fa fa-image"></i>
                                          <label class="fileContainer">
                                             <input type="file" id="fileInput" name="images" multiple>
                                          </label>
                                       </li>
                                       <li>
                                          <i class="fa fa-video-camera"></i>
                                          <label class="fileContainer"for="videoInput">
                                             <input type="file"id="videoInput" name="videos" multiple>
                                          </label>
                                       </li>
                                       <li>
                                          <i class="fa fa-camera"></i>
                                          <label class="fileContainer">
                                             <input type="file">
                                          </label>
                                       </li>
                                       <li>
                                       <div class="other-option">
                                          <div class="d-flex align-items-center justify-content-between">
                                             <div class="d-flex align-items-center">
                                                <div class="user-img me-3">      
                                                   <div id="preview-container" class="image-size">
                                                   
                                                   </div>
                                                   
                                                </div>          
                                             </div>                
                                          </div>
                                       </div>
                                       </li>
                                       <li>
                                          <button type="submit">Post</button>
                                       </li>
                                    </ul>
                                 </div>
                              </form>
                           </div>
                        </div>
                     </div><!-- add post new box -->

                     <div class="loadMore">
                        {% for post in posts %}
                        <div class="central-meta item">
                           <div class="user-post">                             
                              <div class="friend-info">
                                 <figure>
                                    <img src="{{post.author.avatar.url}}" alt="" style="    height: 48px;
                                    width: 47px;">
                                 </figure>
                                 <div class="friend-name">
                                    <ins><a href="time-line.html" title="">{{ post.author.first_name }} {{ post.author.last_name }}</a></ins>
                                    <span>published:{{ post.created_at }}</span>
                                 </div>
                                 <p>{{ post.content }}</p>
                                 <div class="post-meta">
                                    <!-- {% for image in post.images.all %}
                                    <span class="profile-img-content"
                                    style="background-image: url({{ image.image.url }});"></span>
                                    {% endfor %} -->
                                    <!-- <div class="image-gallery">
                                       {% for image in post.images.all %}
                                       <div class="custom-image-item"style="background-image: url({{ image.image.url }});width: 500px; height: 500px; border: 1px solid black"></div>
                                       
                                       {% endfor %}
                                    </div> -->
                                    <div class="video-container">
                                
                                       {% for video in post.video.all %}
                                         <div class="video-wrapper">
                                           <video controls style="    width: 653px;;">
                                               {% csrf_token %}
                                             <source src="{{video.video.url}}" type="video/mp4">
                                           </video>
                                         </div>
                                       {% endfor %}
                                   </div>
                                    <div class="image-gallery">
                                       <!-- {% for image in post.images.all %}
                                       <a class="strip" href="url({{ image.image.url }})" title="" data-strip-group="mygroup" data-strip-group-options="loop: false">
                                          <img src="url({{ image.image.url }})" alt=""><div class="custom-image-item"style=" height:300px  ; ;width:300px ; background-image: url({{ image.image.url }}); background-size: cover; background-position: center; background-repeat: no-repeat; "></div></a>
                                       {% endfor %} -->
                                       {% for image in post.images.all %}
                                       <a class="strip" href="{{ image.image.url }}" title="" data-strip-group="mygroup" data-strip-group-options="loop: false">
                                          <img src="url({{ image.image.url }})" alt=""><div class="custom-image-item"style=" height:300px  ; ;width:300px ; background-image: url({{ image.image.url }}); background-size: cover; background-position: center; background-repeat: no-repeat; "></div>
                                       <!-- <div class="custom-image-item" style="height: 300px; width: 300px; background-image: url({{ image.image.url }}); background-size: cover; background-position: center; background-repeat: no-repeat;"></div> -->
                                        </a>
                                       {% endfor %}

                                    </div>
                                    <div class="we-video-info">
                                       <ul>
                                          {% if post.liked == 'True' %}
                                          <li>
                                             <a href="{% url 'app_social:like_post' post.id %}">
                                                <span class="like" data-toggle="tooltip" title="like">
                                                   <i class="ti-heart"></i>
                                                   <ins>{{post.likes.count}}</ins>
                                                </span>
                                               
                                             </a>
                                          </li>
                                          {% else %}
                                          <li>
                                             <a href="{% url 'app_social:like_post' post.id %}">
                                                <span class="dislike" data-toggle="tooltip" title="dislike">
                                                   <i class="ti-heart-broken"></i>
                                                   <ins>{{post.likes.count}}</ins>
                                                </span>
                                             </a>
                                          </li>
                                          {% endif %}
                                          <li>
                                             <span class="views" data-toggle="tooltip" title="views">
                                                <i class="fa fa-eye"></i>
                                                <!-- <ins>1.2k</ins> -->
                                             </span>
                                          </li>
                                          <li>
                                             <span class="comment" data-toggle="tooltip" title="Comments">
                                                <i class="fa fa-comments-o"></i>
                                                <!-- <ins>52</ins> -->
                                             </span>
                                          </li>

                                          <li class="social-media">
                                             <div class="menu">
                                                <div class="btn trigger"><i class="fa fa-share-alt"></i></div>
                                                <div class="rotater">
                                                   <div class="btn btn-icon"><a href="#" title=""><i
                                                            class="fa fa-html5"></i></a></div>
                                                </div>
                                                <div class="rotater">
                                                   <div class="btn btn-icon"><a href="#" title=""><i
                                                            class="fa fa-facebook"></i></a></div>
                                                </div>
                                                <div class="rotater">
                                                   <div class="btn btn-icon"><a href="#" title=""><i
                                                            class="fa fa-google-plus"></i></a></div>
                                                </div>
                                                <div class="rotater">
                                                   <div class="btn btn-icon"><a href="#" title=""><i
                                                            class="fa fa-twitter"></i></a></div>
                                                </div>
                                                <div class="rotater">
                                                   <div class="btn btn-icon"><a href="#" title=""><i
                                                            class="fa fa-css3"></i></a></div>
                                                </div>
                                                <div class="rotater">
                                                   <div class="btn btn-icon"><a href="#" title=""><i
                                                            class="fa fa-instagram"></i></a>
                                                   </div>
                                                </div>
                                                <div class="rotater">
                                                   <div class="btn btn-icon"><a href="#" title=""><i
                                                            class="fa fa-dribbble"></i></a>
                                                   </div>
                                                </div>
                                                <div class="rotater">
                                                   <div class="btn btn-icon"><a href="#" title=""><i
                                                            class="fa fa-pinterest"></i></a>
                                                   </div>
                                                </div>

                                             </div>
                                          </li>
                                       </ul>
                                    </div>
                                    
                                 </div>
                              </div>
                             
                              <div class="coment-area">
                                            
                                 <ul class="we-comet">
                                    {% if user.username %}
                               {% for comment in comments %}
                                 {% if comment.post.id == post.id %}
                                    <li>
                                       <div class="comet-avatar">
                                          <img src="/media/{{comment.author.avatar}}" alt="" style="    height: 40px;
                                          width: 41px;">
                                       </div>
                                       <div class="we-comment">
                                          <div class="coment-head">
                                             <h5><a href="time-line.html" title="">{{comment.author.last_name}} {{comment.author.first_name}}</a></h5>
                                             <span>{{comment.created_at}}</span>                                                                                                                                                                                                                    
                                             <p>{{comment.content}}</p>
                                            
                                             <div class="comment" id="comment_{{ comment.id }}">                                                     
                                                 <a class="btn btn-primary btn-sm reply-button d-inline-block" style="background: none; border: none;        margin-top: -6px; " data-comment-id="{{ comment.id }}">Reply</i></a>
                                             
                                                 <!-- Reply Form (initially hidden) -->
                                                 
                                                 <form method="post" class="reply-form" style="display: none;"
                                                 action="{% url 'app_social:commentPost' post.id %}">
                                                 {% csrf_token %}
                                                 <input type="hidden" name="comment_id" value="{{ comment.id }}">
                                                 <textarea class="comment-textarea" name="text"
                                                 placeholder="Viết bình luận..."></textarea>
                                                 <button class="comment-button" type="submit"
                                                 name="reply_comment">Send</button>
                                                 </form>
                                                 <!-- Reply Container -->
                                                 <div class="replies-container">
                                                     <!-- Display replies here -->
                                                 </div>
                                             </div>
                                             
                                             {% if comment.author == user %}
                                             <div class="comment" id="comment_{{ comment.id }}">                                                     
                                             <a class="btn btn-primary btn-sm reply-button d-inline-block" style="background: none; border: none;    margin-left: 60px;
                                             margin-top: -54px; " data-comment-id="{{ comment.id }}">Edit</i></a>
                             
                                             
                                             <form action="{% url 'app_social:commentPost' post.id %}" method="post"class="reply-form"style="display: none;">
                                             {% csrf_token %}
                                             <input type="hidden" name="comment_id" value="{{comment.id}}">
                                             <input type="hidden" name="comment_id" value="{{comment.id}}">
                                             <textarea required class="reply-textarea" name="content" placeholder="Nhập bình luận của bạn">{{comment.content}}</textarea>
                                             <button class="submit-reply" type="submit" name="edit_comment">Edit</button>   
                                             </form>
                                             </div>
                                             
                                             {% endif %}                                                  
                                             {% if post.author == user or comment.author == user %}                                                   
                                             <div class="xoa" style="margin-top: -50px;;
                                             margin-left: 55px;">
                                             <a href="{% url 'app_social:deleteComment' comment.id %}" style="margin-left: 60px;
                                             margin-top: -54px; ">Xóa</a>                                         
                                             </div>
                                             {% endif %}
                                             
                                       </div>
                                       </div>
                                       {% for reply in reply_comment_post %}
                                       {% if reply.comment.id == comment.id %}  
                                       <ul>
                                         
                                          <li>
                                             <div class="comet-avatar">
                                                <img src="{{reply.author.avatar.url}}" alt=""style="    height: 40px;
                                                width: 41px;">
                                             </div>
                                             <div class="we-comment">
                                                <div class="coment-head">
                                                   <h5><a href="time-line.html" title="">{{reply.author.last_name}} {{reply.author.first_name}}</a></h5>
                                                   <span>{{reply.created_at}}</span>                                                               
                                                 <p>{{reply.text}}</p>
                                                 
                                                 {% if comment.author == request.user %} 
                                                <div class="comment" id="comment_{{ comment.id }}">                                                     
                                                 <a class="btn btn-primary btn-sm reply-button d-inline-block" style="background: none; border: none;       margin-left: 17px;
                                                     margin-top: -38px;" data-comment-id="{{ comment.id }}">Edit</i></a>
                                 
                                                 
                                                   <form action="{% url 'app_social:commentReplyPost' post.id %}" method="post"class="reply-form"style="display: none;">
                                                   {% csrf_token %}
                                                    <input type="hidden" name="return_profile" value="return">
                                                   <input type="hidden" name="reply" value="{{reply.id}}">
                                                    <textarea required class="reply-textarea" name="content" placeholder="Nhập bình luận của bạn">{{reply.text}}</textarea>
                                                    <button class="submit-reply" type="submit" name="edit_commentReply">Edit</button>
                                                 </form>
                                                 </div>
                                                 {% endif %}
                                                 
                                                 <div class="xoa" style="    margin-top: -43px;
                                                 margin-left: 78px;">
                                                
                                                {% if post.author == user or comment.author == user %}                                           
                                                 <a href="{% url 'app_social:deleteReplyCommentPost' reply.id  %}">Xóa</a>
                                                 
                                                 {% endif %}
                                                 </div>
                                                </div>
                                                
                                                
                                             </div>
                                          </li>
                                          
                                       </ul>
                                       {% endif %}
                                     {% endfor %}
                                    </li>
                                    {% endif %}
                                    {% endfor %}
                                   


                                   
                                    <li class="post-comment">
                                       <div class="comet-avatar">
                                          <img src="/media/{{ user.avatar }}" alt="" style="    width: 46px;
                                          height: 41px;">
                                       </div>
                                       <div class="post-comt-box">
                                         <form class="flex-fill ps-2" method="post"
                                         action="{% url 'app_social:commentPost' post.id %}"> 
                                         <input type="hidden" name="post_id" value="{{ post.id }}">
                                             {% csrf_token %}
                                             <input type="text" name="content"
                                             class="form-control rounded-pill bg-white bg-opacity-15"
                                             style="padding-right: 120px;"
                                             placeholder="Write a comment..." />
                                             
                                              
                                             <button class="comment-button" type="submit"
                                             name="add_comment">Comment</button>
                                          </form>
                                       </div>
                                    </li>
                                   
                                 </ul>
                                 
                              </div>
                              {% endif %}


                           </div>
                        </div>
                        {% endfor %}
                     </div>
                  </div><!-- centerl meta -->

                  <div class="col-lg-3">
                     <aside class="sidebar static">


                        <div class="widget friend-list stick-widgets">
                           <h4 class="widget-title">Friends</h4>
                           <div id="searchDir"></div>
                           
                           <ul id="people-list" class="friendz-list">
                              {% for friend in friendss %}
                              <li>
                                 <figure>
                                    <img src="/media/{{friend.user2.avatar}}" alt="" style="    width: 100px;
                                    height: 41px;">
                                    <span class="status f-online"></span>
                                 </figure>
                                 <div class="friendz-meta">
                                    <a href="{% url 'app_social:user_profile' friend.user2.username %}">{{friend.user2.last_name}}
                                       {{friend.user2.first_name}}</a>
                                    <i><a href="https://wpkixx.com/cdn-cgi/l/email-protection" class="__cf_email__"
                                          data-cfemail="a0d7c9ced4c5d2d3cfccc4c5d2e0c7cdc1c9cc8ec3cfcd">{{friend.user2.lives}}</a></i>
                                 </div>
                              </li>
                              {% endfor %}
                           </ul>
                          
                        </div><!-- friends list sidebar -->
                        <div class="widget stick-widgetas">
                           <h4 class="widget-title">Page</h4>                          
                           <ul class="followers">
                              {% for page in fanpage %}
                              <li>
                                 <figure><img src="{{ page.imgFanpage.url }}" alt="" style="width: 100px; height: 47px;">
                                 </figure>
                                 <div class="friend-meta">
                                    <h4><a href="{% url 'app_social:fanpage' page.id %}"
                                          title>{{page.name}}</a></h4>
                                    {% if user|striptags != page.author.username|striptags and not user in page.members.all %}
                                    <a href="{% url 'app_social:join_fanpage' page.id %}" title=""
                                       class="underline">Theo Dõi</a>  
                                    {% endif %}                                
                                 </div>                                                                                                         
                           </li>
                           {% endfor %}
                           </ul>                          
                        </div><!-- who's following -->
                     </aside>
                     
                  </div><!-- sidebar -->
               </div>
            </div>
         </div>
      </div>
   </div>
</section>
{% endblock %}



  
